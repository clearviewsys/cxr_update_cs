<!DOCTYPE html>
<html lang="en">

<head>

    <!--#4DSCRIPT/webRedirectIfNotAuthorized-->

    <!--#4DSCRIPT/WAPI_4DInclude/customers/include/head.shtml -->



    <script type="text/javascript">
        function loadGrid(element) {

            /*
              if(wapi_filter === undefined){
                var wapi_filter = {customers___customerid: '<!--#4DTEXT [Customers]customerid -->'};
            };
            */

            console.trace();

            var theFilter = element.id.replace("grid-data-", "");
            var wapi_filter = theFilter;

            /*
            if(num === 0){
                num = 1
            } else {
                
                for(i = 0; i < 3; i++){
                    
                    var $temp = $("div#ewires-grid-"+i+1);
                    var temp = $temp.pqGrid('instance');
                    
                    if(temp !== undefined){
                        $temp.pqGrid("destroy");
                    }
                    
                }           
            }
            */


            if (theFilter === undefined) {
                var theFilter = ''
            }

            <!--#4DINCLUDE ../pq/include/pq_gettablename.js-->
            <!--#4DINCLUDE ../pq/include/pq_datepicker.js-->  
            <!--#4DINCLUDE ../pq/include/pq_viewRecord.js-->  
            <!--#4DINCLUDE ../pq/include/pq_commentRender.js--> 

            //--------- INITIALIZATION FUNCTION -----------
            <!--#4DINCLUDE ../pq/include/pq_initGrid.js-->


            //--------- DEFINE GRID OBJECT -----------
            //          NOTE: grid object var = obj
            var obj = {
                //create grid with defaults
                <!--#4DINCLUDE ../pq/include/pq_createGrid.js--> 
                //set override - additional options
                height: "100%",
                showTitle: false,
                rowHt: 35,
            };

            //----------- CREATE EVENT  -- USED FOR TOOL TIP WIDGET -------------            


            //----------- DATA READY EVENT (this sets the listbox title) --------------
            obj.dataReady = function() {
                <!--#4DINCLUDE ../pq/include/pq_evtDataReady.js-->
            };

            //---------- BEFORE SORT EVENT ------------     
            obj.beforeSort = function(evt) {
                <!--#4DINCLUDE ../pq/include/pq_evtBeforeSort.js-->
            };

            //---------- BEFORE TABLE VIEW EVENT ------------           
            obj.beforeTableView = function(evt, ui) {
                <!--#4DINCLUDE ../pq/include/pq_evtBeforeTableView.js-->
            };

            //---------- DOUBLE CLICK EVENT ------------
            obj.cellDblClick = function(evt, ui) {
                <!--#4DINCLUDE ../pq/include/pq_evtDoubleClick.js-->   
            };

            //--------------CREATE TOOLBAR  ------------- 


            //--------------- DEFINE COLUMN MODEL -------------------
            obj.colModel = [

                // ADD COLUMNS TO THE GRID HERE -- USE 4D TABLENAME___FIELDNAME 
                // THE FIRST COLUMN SHOULD BE THE PK/ID FIELD FOR THE TABLE - YOU CAN SET HIDDEN:TRUE
                // https://paramquery.com/pro/api#option-colModel <-- doc's and options


                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:ewires___ewireid, filter:false, hidden:true} -->,
                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:ewires___senddate, title:Date ,filter:false, align:center, maxWidth:80} -->,   			
                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:ewires___issettled, title:Settled, filter:false, maxWidth:50} -->,

                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:ewires___beneficiaryFullName,title:Beneficiary, filter:false} -->,
                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:ewires___fromCountry,title:From, filter:false} -->,
                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:ewires___toCountry,title:To, filter:false} -->,
                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:ewires___currency,title:CCY, filter:false, maxWidth:50} -->,
                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:ewires___fromAmount,title:From-Amt, format:currency , filter:false} -->,
                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:ewires___toAmount,title:To-Amt, format:currency, filter:false} -->,

            ];

            // ------------- DEFINE DATAMODEL -----------
            obj.dataModel = {
                <!--#4DINCLUDE ../pq/include/pq_dataModel.js--> 
            };


            //--------------DEFINE SORTMODEL -------------
            obj.sortModel = {
                <!--#4DINCLUDE ../pq/include/pq_sortModel.js-->

                type: 'remote',
                sorter: [{
                    dataIndx: 'ewires___senddate',
                    dir: 'up'
                }],
            };


            obj.filterModel = {
                header: false,
                on: false,
            }

            //--------------DEFINE GROUP MODEL -------------
            // NONE



            //---------- INSERT THE GRID INTO THE DOM ---------------
            var ewiresGrid = pq.grid("div#ewires-grid-" + theFilter, obj);

        };

    </script>




    <!-- TIMER CODE -->
    <script type="text/javascript">
        //document.getElementById('expiretimer').innerHTML =05 + ":" + 00;
        //startTimer();

        function startTimer() {
            var presentTime = document.getElementById('expiretimer').innerHTML;
            if (presentTime == " ") {
                presentTime = "01:00";
            } else {
                if (presentTime == "") {
                    presentTime = "01:00";
                }
            };

            var timeArray = presentTime.split(/[:]+/);
            var m = timeArray[0];
            var s = checkSecond((timeArray[1] - 1));

            if (s == 59) {
                m = m - 1
            }

            if (m < 0) {
                wapiObjectMethod() //refresh the form
                m = 1;
                s = 00;
                document.getElementById('expiretimer').innerHTML = "";
            } else {
                document.getElementById('expiretimer').innerHTML = m + ":" + s;
                if (timer === undefined) {
                    var timer = setTimeout(startTimer, 1000);
                }
            }
        }

        function checkSecond(sec) {
            if (sec < 10 && sec >= 0) {
                sec = "0" + sec
            }; // add zero in front of numbers < 10
            if (sec < 0) {
                sec = "59"
            };
            return sec;
        }

    </script>


    <!-- wapiObjectMethod CODE -->
    <script type="text/javascript">
        function wapiObjectMethod(event) {
            var formData = $("form").serializeArray();

            if (event === undefined) {
                $.post('objectmethod', {
                        form: $("form").attr('id'),
                        evt: 'expire',
                        source: 'timer',
                        userInput: formData
                    })
                    .done(function(data) {
                        eval(data); //execute the javascript sent back from 4D
                    });
            };

            if (event !== undefined) {
                $.post('objectmethod', {
                        form: $("form").attr('id'),
                        evt: event.type,
                        source: event.target.id,
                        userInput: formData
                    })
                    .done(function(data) {
                        eval(data); //execute the javascript sent back from 4D
                    });
            };
        }

    </script>


    <!-- ON READY -->
    <script type="text/javascript">
        $(function() {

            // ADD ON SHOW ACCORDIAN EVENT HERE -----         


            $('#grid-data-sent-pending').on('show.bs.collapse', function() {
                loadGrid(this);
            });

            $('#grid-data-received-pending').on('show.bs.collapse', function() {
                loadGrid(this);
            });

            $('#grid-data-received-settled').on('show.bs.collapse', function() {
                loadGrid(this);
            });


            $('#grid-data-sent-settled').on('show.bs.collapse', function() {
                loadGrid(this);
            });



        })

    </script>


    <!-- pq-grid-header-table -->
    <style>
        pq-grid-header-table {
        color: magenta;
        font-style: italic;
        font-weight: bold;
        
    }    
    
</style>

</head>

<body>

    <!--#4DINCLUDE include/menubar.shtml -->
    <main role="main">

        <div class="page-header">
            <!-- JUMBOTRON - WELCOME -->
            <div class='container'>
                <!--#4DSCRIPT/webSelectCustomerRecord-->
                <!--#4DHTML WAPI_includeAlertMessage-->
                <script src="/app/js/bootstrap-auto-dismiss-alert.js"></script>
                <!--MUST COME AFTER THE ALERT YOU WANT TO CLOSE -->

                <h1>Ewire Listings for:
                    <!--#4DTEXT [customers]firstname-->
                </h1>

            </div>
        </div>

        <div class="container content">

            <!--Row with two equal columns-->
            <div class="row">


                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <!-- must set height here for grid to honor-->

                    <div class="panel-group" id="accordion-grids" role="tablist" aria-multiselectable='true'>

                        <!-- GRID SENT-PENDING HERE -->
                        <div class="panel panel-default">

                            <div class="panel-heading" role="tab" id="grid-tab-sent-pending">
                                <h3 class="panel-title">
                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion-grids" href="#grid-data-sent-pending" aria-expanded="false" aria-controls="grid-data-sent-pending">
                                        <span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"> </span> Sent Pending Ewires for
                                        <!--4DTEXT [Customers]firstname + " "+[Customers]lastname--></a>
                                </h3>
                            </div>

                            <div id="grid-data-sent-pending" class="panel-collapse collapse" role="tabpanel" aria-labelledby="grid-tab-sent-pending">

                                <div class="panel-body">

                                    <div class='form-group' style='height: 600px'>
                                        <div id="ewires-grid-sent-pending"></div><!-- INSERT GRID HERE -->
                                    </div>

                                    <div id='ewires-grid-footer' class='text-muted small' style="padding-top: 20px; padding-bottom: 20px">* Please contact your representative with specific questions.</div>

                                </div>
                            </div>
                        </div>


                        <!-- GRID SENT-SETTLED HERE -->
                        <div class="panel panel-default">

                            <div class="panel-heading" role="tab" id="grid-tab-sent-settled">
                                <h3 class="panel-title">
                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion-grids" href="#grid-data-sent-settled" aria-expanded="false" aria-controls="grid-data-sent-settled">
                                        <span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"> </span> Sent Settled Ewires for
                                        <!--4DTEXT [Customers]firstname + " "+[Customers]lastname--></a>
                                </h3>
                            </div>

                            <div id="grid-data-sent-settled" class="panel-collapse collapse" role="tabpanel" aria-labelledby="grid-tab-sent-settled">

                                <div class="panel-body">

                                    <div class='form-group' style='height: 600px'>
                                        <div id="ewires-grid-sent-settled"></div><!-- INSERT GRID HERE -->
                                    </div>

                                    <div id='ewires-grid-footer' class='text-muted small' style="padding-top: 20px; padding-bottom: 20px">* Please contact your representative with specific questions.</div>

                                </div>
                            </div>
                        </div>



                        <!-- GRID RECEIVED-SETTLED HERE -->
                        <div class="panel panel-default">

                            <div class="panel-heading" role="tab" id="grid-tab-received-settled">
                                <h3 class="panel-title">
                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion-grids" href="#grid-data-received-settled" aria-expanded="false" aria-controls="grid-data-received-settled">
                                        <span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"> </span> Recieved AND Settled Ewires for
                                        <!--4DTEXT [Customers]firstname + " "+[Customers]lastname--></a>
                                </h3>
                            </div>

                            <div id="grid-data-received-settled" class="panel-collapse collapse" role="tabpanel" aria-labelledby="grid-tab-received-settled">

                                <div class="panel-body">

                                    <div class='form-group' style='height: 600px'>
                                        <div id="ewires-grid-received-settled"></div><!-- INSERT GRID HERE -->
                                    </div>
                                    <div id='ewires-grid-footer' class='text-muted small' style="padding-top: 20px; padding-bottom: 20px">* Please contact your representative with specific questions.</div>

                                </div>
                            </div>
                        </div>

                        <!-- GRID RECEIVED-PENDING HERE -->
                        <div class="panel panel-default">

                            <div class="panel-heading" role="tab" id="grid-tab-received-pending">
                                <h3 class="panel-title">
                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion-grids" href="#grid-data-received-pending" aria-expanded="false" aria-controls="grid-data-received-pending">
                                        <span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"> </span> Received and Pending Ewires for
                                        <!--4DTEXT [Customers]firstname + " "+[Customers]lastname--></a>
                                </h3>
                            </div>

                            <div id="grid-data-received-pending" class="panel-collapse collapse" role="tabpanel" aria-labelledby="grid-tab-received-pending">

                                <div class="panel-body">

                                    <div class='form-group' style='height: 600px'>
                                        <div id="ewires-grid-received-pending"></div><!-- INSERT GRID HERE -->
                                    </div>
                                    <div id='ewires-grid-footer' class='text-muted small' style="padding-top: 20px; padding-bottom: 20px">* Please contact your representative with specific questions.</div>

                                </div>
                            </div>
                        </div>


                    </div>


                </div>
            </div>

        </div>

        <div class="modal fade" id="timerAlert" role='dialog'>
            <div class="modal-dialog">

                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                        <h4 class="modal-title">Rates have refreshed.</h4>
                    </div>

                    <div class="modal-body">
                        <p id='timerAlertText'></p>
                    </div>
                    <div class="modal-footer">
                        <a href="#" data-dismiss="modal" class="btn btn-default">Close</a>
                    </div>

                </div>
            </div>
        </div>

    </main>

    <!--#4DSCRIPT/WAPI_4DInclude/customers/include/footer.shtml -->
</body>



</html>
