<!DOCTYPE html>
<html lang="en">
<head>

<!--#4DSCRIPT/webRedirectIfNotAuthorized-->
    
<!--#4DSCRIPT/WAPI_4DInclude/agents/include/head.shtml-->

<!-- PQGRID -->
 <script type="text/javascript"> //PQGRID
   $(function () {
       
               if(wapi_filter === undefined){
           var wapi_filter = {customers___customerid: '<!--#4DTEXT [Customers]customerid -->'};
       };
        
        <!--#4DINCLUDE ../pq/include/pq_gettablename.js-->
        <!--#4DINCLUDE ../pq/include/pq_datepicker.js-->  
        <!--#4DINCLUDE ../pq/include/pq_viewRecord.js-->  
        <!--#4DINCLUDE ../pq/include/pq_commentRender.js--> 
   
//--------- INITIALIZATION FUNCTION -----------
		<!--#4DINCLUDE ../pq/include/pq_initGrid.js-->
        
        
//--------- DEFINE GRID OBJECT -----------
//          NOTE: grid object var = obj
    var obj = {
        //create grid with defaults
		      <!--#4DINCLUDE ../pq/include/pq_createGrid.js--> 
        //set override - additional options
                height: "100%",
                showTitle: false,
                rowHt: 35,
            };

//----------- CREATE EVENT  -- USED FOR TOOL TIP WIDGET -------------            

        
//----------- DATA READY EVENT (this sets the listbox title) --------------
    obj.dataReady = function() {
		<!--#4DINCLUDE ../pq/include/pq_evtDataReady.js-->
        };
        
//---------- BEFORE SORT EVENT ------------     
    obj.beforeSort = function (evt) {
		<!--#4DINCLUDE ../pq/include/pq_evtBeforeSort.js-->
        };
        
 //---------- BEFORE TABLE VIEW EVENT ------------           
    obj.beforeTableView = function (evt, ui) {
		<!--#4DINCLUDE ../pq/include/pq_evtBeforeTableView.js-->
            };
        
//---------- DOUBLE CLICK EVENT ------------
    obj.cellDblClick = function (evt, ui) {
        <!--#4DINCLUDE ../pq/include/pq_evtDoubleClick.js-->   
        };
                    
//--------------CREATE TOOLBAR  ------------- 

        
//--------------- DEFINE COLUMN MODEL -------------------
    obj.colModel = [
        
        // ADD COLUMNS TO THE GRID HERE -- USE 4D TABLENAME___FIELDNAME 
        // THE FIRST COLUMN SHOULD BE THE PK/ID FIELD FOR THE TABLE - YOU CAN SET HIDDEN:TRUE
        // https://paramquery.com/pro/api#option-colModel <-- doc's and options
        
        
        <!--#4DSCRIPT/WAPI_getColModelColumn/{field:links___linkid, filter:false, hidden:true} -->,
        <!--#4DSCRIPT/WAPI_getColModelColumn/{field:links___fullname, title:Name ,filter:false} -->,   			
	    <!--#4DSCRIPT/WAPI_getColModelColumn/{field:links___relationship, title:Relationship, filter:false} -->,
        <!--#4DSCRIPT/WAPI_getColModelColumn/{field:links___city,title:City, filter:false} -->,
        <!--#4DSCRIPT/WAPI_getColModelColumn/{field:links___country,title:Country, filter:false} -->,
        <!--#4DSCRIPT/WAPI_getColModelColumn/{field:links___mainphone,title:Main-Phone, filter:false} -->,
        <!--#4DSCRIPT/WAPI_getColModelColumn/{field:links___email,title:Email, filter:false} -->,
		
		];
			
// ------------- DEFINE DATAMODEL -----------
    obj.dataModel = {
		<!--#4DINCLUDE ../pq/include/pq_dataModel.js--> 
       };

        
//--------------DEFINE SORTMODEL -------------
    obj.sortModel = {
		<!--#4DINCLUDE ../pq/include/pq_sortModel.js-->
           
            type: 'remote',
            sorter: [{dataIndx: 'links___fullname', dir: 'up'}],            
        };
       
       
       obj.filterModel = {
           header: false,
           on: false,
       }
		
//--------------DEFINE GROUP MODEL -------------
// NONE
       
  
//-------------- ON DOUBLE-CLICK -- OPEN DETAIL FORM -------------
     obj.rowDblClick = function(evt, ui) {

    var id = ui.rowData.links___linkid;
    var name = ui.rowData.ewires___beneficiaryfullname;

    var viewForm = new FormData();

    viewForm.append('links___linkid', id);
    viewForm.append('table', 'links');
    viewForm.append('primarykey', 'links___linkid');
    viewForm.append('action', 'view');
    viewForm.append('readonly', 'true');
    viewForm.append('form-post', 'agents/links-dialog.shtml');

    var request = new XMLHttpRequest();

    request.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            // document.open(); // opens the form and replaces current page
            // document.write(request.responseText);
            // document.close();

            $('#dialog-body').html(request.responseText) //inject the response page into the dialog div
            //$('#dialog').dialog('option','width', 500); //jquery
            //$('#dialog').dialog();

            $('#dialog').modal('show'); //bootstrap

        }
    };


    request.responseType = 'text';
    request.open('POST', 'postPage');
    request.send(viewForm);
    request.response

};


//---------- INSERT THE GRID INTO THE DOM ---------------
        var linksGrid = pq.grid("div#links-grid", obj);

    });

</script>    
    
<script>
    $(document).ready(function(){
       wapiObjectMethod(event); //get current rates and values applied right away from 4D
    });
</script>
    

</head>
<body>
    
    <!--#4DSCRIPT/WAPI_4DInclude/agents/include/menubar.shtml-->
<div role="main">

<div class="page-header">
<div class='container'>
    <!--#4DSCRIPT/webSelectAgentRecord-->
    <!--#4DHTML WAPI_includeAlertMessage-->
    <script src="/app/js/bootstrap-auto-dismiss-alert.js"></script> <!--MUST COME AFTER THE ALERT YOU WANT TO CLOSE -->
    
    <h1>Counterparties for:  <!--#4DTEXT [agents]fullname--> </h1>
    
</div>
</div>
    
<div class="container content">
    <!--#4DSCRIPT/webSelectCustomerRecord-->
 
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"> <!-- must set height here for grid to honor-->
        
        <div class="panel-group" id="accordion-links" role="tablist" aria-multiselectable='true'></div>
            
        <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="links-tab">
                <h3 class="panel-title">
                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion-links" href="#links-data" aria-expanded="false" aria-controls="links-data">
                    <span class="glyphicon glyphicon-euro" aria-hidden="true"></span> Links/Counterparties for  <!--4DTEXT [Agents]fullname--> Country Code: <!--4DTEXT [Agents]countrycode-->
                    </a>
                </h3>
            </div>
            
            <div id="links-data" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="links-tab">
                 <div class="panel-body">
        
            <div class='form-group' style='height: 600px'>
                <div id="links-grid"></div><!-- INSERT GRID HERE -->
            </div>
            <div id='links-grid-footer' class='text-muted small' style="padding-top: 20px; padding-bottom: 20px">* Please contact your representative with specific questions.</div>
                
        </div>
            </div>
        </div>
            
        </div>   
            
        </div>
        </div>
        
</div>
    
<!-- DIALOG FOR LINKS -->
    <!--#4DSCRIPT/WAPI_4DInclude/agents/links-dialog-div.shtml-->

   
     <!--#4DSCRIPT/WAPI_4DInclude/agents/include/footer.shtml-->
</body>
   

    
</html>                            