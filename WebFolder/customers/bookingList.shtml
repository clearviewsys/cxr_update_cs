<!DOCTYPE html>
<html lang="en">

<head>

    <!--#4DSCRIPT/webRedirectIfNotAuthorized-->

    <!--#4DSCRIPT/WAPI_4DInclude/customers/include/head.shtml -->

    <script type="text/javascript">
        $(function() {

            if (wapi_filter === undefined) {
                var wapi_filter = {
                    customers___customerid: '<!--#4DTEXT [Customers]customerid -->'
                };
            };

            <!--#4DINCLUDE ../pq/include/pq_gettablename.js-->
            <!--#4DINCLUDE ../pq/include/pq_datepicker.js-->  
            <!--#4DINCLUDE ../pq/include/pq_viewRecord.js-->  
            <!--#4DINCLUDE ../pq/include/pq_commentRender.js--> 

            //--------- INITIALIZATION FUNCTION -----------
            <!--#4DINCLUDE ../pq/include/pq_initGrid.js-->


            //--------- DEFINE GRID OBJECT -----------
            //          NOTE: grid object var = obj
            var obj = {
                //create grid with defaults
                <!--#4DINCLUDE ../pq/include/pq_createGrid.js--> 
                //set override - additional options
                height: "100%",
                showTitle: false,
                rowHt: 35,
            };

            //----------- CREATE EVENT  -- USED FOR TOOL TIP WIDGET -------------            


            //----------- DATA READY EVENT (this sets the listbox title) --------------
            obj.dataReady = function() {
                <!--#4DINCLUDE ../pq/include/pq_evtDataReady.js-->
            };

            //---------- BEFORE SORT EVENT ------------     
            obj.beforeSort = function(evt) {
                <!--#4DINCLUDE ../pq/include/pq_evtBeforeSort.js-->
            };

            //---------- BEFORE TABLE VIEW EVENT ------------           
            obj.beforeTableView = function(evt, ui) {
                <!--#4DINCLUDE ../pq/include/pq_evtBeforeTableView.js-->
            };

            //---------- DOUBLE CLICK EVENT ------------
            obj.cellDblClick = function(evt, ui) {
                <!--#4DINCLUDE ../pq/include/pq_evtDoubleClick.js-->   
            };

            //--------------CREATE TOOLBAR  ------------- 


            //--------------- DEFINE COLUMN MODEL -------------------
            obj.colModel = [

                // ADD COLUMNS TO THE GRID HERE -- USE 4D TABLENAME___FIELDNAME 
                // THE FIRST COLUMN SHOULD BE THE PK/ID FIELD FOR THE TABLE - YOU CAN SET HIDDEN:TRUE
                // https://paramquery.com/pro/api#option-colModel <-- doc's and options


                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:bookings___bookingid, filter:false, hidden:true} -->,
                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:bookings___bookingdate, title:Date ,filter:false, align:center, maxWidth:100} -->,   			
                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:bookings___currency, title:CCY, filter:false, maxWidth:50} -->,
                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:bookings___amount,title:Amount, format:currency, filter:false} -->,
                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:bookings___amount,title:Amount, filter:false} -->,
                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:bookings___issell,title:Is-Buy, filter:false} -->,
                <!--#4DSCRIPT/WAPI_getColModelColumn/{field:bookings___isconfirmed,title:Confirmed, filter:false} -->,

            ];

            // ------------- DEFINE DATAMODEL -----------
            obj.dataModel = {
                <!--#4DINCLUDE ../pq/include/pq_dataModel.js--> 
            };


            //--------------DEFINE SORTMODEL -------------
            obj.sortModel = {
                <!--#4DINCLUDE ../pq/include/pq_sortModel.js-->

                type: 'remote',
                sorter: [{
                    dataIndx: 'bookings___bookingdate',
                    dir: 'up'
                }],
            };


            obj.filterModel = {
                header: false,
                on: false,
            }

            //--------------DEFINE GROUP MODEL -------------
            // NONE



            //---------- INSERT THE GRID INTO THE DOM ---------------
            var bookingsGrid = pq.grid("div#bookings-grid-pending", obj);

        });

    </script>

    <script type="text/javascript">
        //document.getElementById('expiretimer').innerHTML =05 + ":" + 00;
        //startTimer();

        function startTimer() {
            var presentTime = document.getElementById('expiretimer').innerHTML;
            if (presentTime == " ") {
                presentTime = "01:00";
            } else {
                if (presentTime == "") {
                    presentTime = "01:00";
                }
            };

            var timeArray = presentTime.split(/[:]+/);
            var m = timeArray[0];
            var s = checkSecond((timeArray[1] - 1));

            if (s == 59) {
                m = m - 1
            }

            if (m < 0) {
                wapiObjectMethod() //refresh the form
                m = 1;
                s = 00;
                document.getElementById('expiretimer').innerHTML = "";
            } else {
                document.getElementById('expiretimer').innerHTML = m + ":" + s;
                if (timer === undefined) {
                    var timer = setTimeout(startTimer, 1000);
                }
            }
        }

        function checkSecond(sec) {
            if (sec < 10 && sec >= 0) {
                sec = "0" + sec
            }; // add zero in front of numbers < 10
            if (sec < 0) {
                sec = "59"
            };
            return sec;
        }

    </script>



    <script type="text/javascript">
        function wapiObjectMethod(event) {
            var formData = $("form").serializeArray();

            if (event === undefined) {
                $.post('objectmethod', {
                        form: $("form").attr('id'),
                        evt: 'expire',
                        source: 'timer',
                        userInput: formData
                    })
                    .done(function(data) {
                        eval(data); //execute the javascript sent back from 4D
                    });
            };

            if (event !== undefined) {
                $.post('objectmethod', {
                        form: $("form").attr('id'),
                        evt: event.type,
                        source: event.target.id,
                        userInput: formData
                    })
                    .done(function(data) {
                        eval(data); //execute the javascript sent back from 4D
                    });
            };
        }

    </script>


    <script>
        $(document).ready(function() {
            wapiObjectMethod(event); //get current rates and values applied right away from 4D
        });

    </script>


</head>

<body>

    <!--#4DSCRIPT/WAPI_4DInclude/customers/include/menubar.shtml -->

    <div role="main">

        <div class="page-header">
            <div class='container'>
                <!--#4DSCRIPT/webSelectCustomerRecord-->
                <!--#4DHTML WAPI_includeAlertMessage-->
                <script src="/app/js/bootstrap-auto-dismiss-alert.js"></script>
                <!--MUST COME AFTER THE ALERT YOU WANT TO CLOSE -->

                <h1>Bookings for:
                    <!--#4DTEXT [customers]firstname-->
                </h1>

            </div>
        </div>

        <div class="container content">

            <div class='row'>

                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <!-- must set height here for grid to honor-->
                    <div class="panel-group" id="accordion-grids" role="tablist" aria-multiselectable='true'>

                        <!-- GRID PENDING HERE -->
                        <div class="panel panel-default">
                            <div class="panel-heading" role='tab' id='grid-tab-pending'>
                                <h3 class="panel-title">
                                    <a class="collapsed" role='button' data-toggle='collapse' data-parent='accordian-grids' href='#grid-data-pending' aria-expanded='false' aria-controls="grid-data-pending">
                                        <span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"></span> Pending Bookings for
                                        <!--4DTEXT [Customers]firstname + " "+[Customers]lastname-->
                                    </a>
                                </h3>


                            </div>



                            <div id="grid-data-pending" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="grid-tab-pending">
                                <div class="panel-body">

                                    <div class='form-group' style='height: 600px'>
                                        <div id="bookings-grid-pending"></div><!-- INSERT GRID HERE -->
                                    </div>
                                    <div id='bookings-grid-footer' class='text-muted small' style="padding-top: 20px; padding-bottom: 20px">* Please contact your representative with specific questions.</div>

                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            </div>

        </div>



    </div>

    <!--#4DSCRIPT/WAPI_4DInclude/customers/include/footer.shtml -->
</body>



</html>
